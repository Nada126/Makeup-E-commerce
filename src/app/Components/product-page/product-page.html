<div class="container my-5" style="margin-top: 100px;">
    <h2 class="text-center text-uppercase mb-4">Makeup Products</h2>

    @if (loading) {
    <div class="text-center my-5">
        <div class="spinner-border text-dark"></div>
        <p>Loading products...</p>
    </div>
    } @else {

    <!-- Categories -->
    <div class="d-flex flex-wrap gap-2 mb-3 justify-content-center">
        <button class="category-btn"
                [class.active]="selectedCategory === 'All'"
                (click)="filterByAll()">
            <i class="bi bi-list"></i> All
        </button>

        @for (category of categories; track $index) {
        <button class="category-btn"
                [class.active]="selectedCategory === category"
                (click)="handleCategoryClick(category)">
            <i [ngClass]="getCategoryIcon(category)"></i> {{ category }}
        </button>
        }
    </div>

    <div class="d-flex gap-4">
        <!-- Filters sidebar -->
        <div class="filters d-flex flex-column gap-3">
            <div class="d-flex flex-column gap-2">
                <label class="form-label fw-bold mb-0">Price</label>
                <select class="form-select form-select-sm" (change)="sortByPrice($event)">
                    <option value="">Sort</option>
                    <option value="low">Low → High</option>
                    <option value="high">High → Low</option>
                </select>
            </div>

            <div class="d-flex flex-column gap-2">
                <label class="form-label fw-bold mb-0">Rating</label>
                <select class="form-select form-select-sm" (change)="sortByRating($event)">
                    <option value="">Sort</option>
                    <option value="low">Low → High</option>
                    <option value="high">High → Low</option>
                </select>
            </div>
        </div>

        <!-- Products Grid -->
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-3 flex-grow-1">
            @for (product of pagedProducts; track product.id ?? $index) {
            <div class="col">
                <div class="card h-100 shadow-sm p-2 text-center">
                    <img [src]="product.image_link || 'https://via.placeholder.com/200'"
                         alt="{{ product.name }}"
                         class="card-img-top"
                         style="height:120px; object-fit:contain;" />
                    <div class="card-body p-2">
                        <h6 class="card-title mb-1">{{ product.name }}</h6>
                        <p class="text-muted small mb-1">{{ product.brand || 'Unknown' }}</p>
                        <p class="fw-bold mb-1">${{ product.price }}</p>

                        <!-- Stars -->
                        <div class="text-warning small">
                            @for (filled of getStarsArray(product.rating); track $index) {
                            <i class="bi" [ngClass]="filled ? 'bi-star-fill' : 'bi-star'"></i>
                            }
                        </div>
                    </div>
                </div>
            </div>
            }
        </div>
    </div>

    <!-- Pagination -->
    @if (totalPages > 1) {
    <nav class="mt-4">
        <ul class="pagination justify-content-center">
            @for (page of totalPagesArray; track $index) {
            <li class="page-item" [class.active]="currentPage === page">
                <button class="page-link" (click)="changePage(page)">{{ page }}</button>
            </li>
            }
        </ul>
    </nav>
    }
    }
</div>
