<div class="container my-5" style="margin-top: 100px">
  <!-- Back Button -->
  <button class="btn btn-outline-secondary mb-3" (click)="navigateToProducts()">
    ‚Üê Go to All Products
  </button>

  <h2 class="text-center text-uppercase mb-4">{{ pageTitle }} Products</h2>

  @if (loading) {
  <div class="loading-container">
    <div class="custom-spinner"></div>
    <p class="loading-text">Loading {{ pageTitle.toLowerCase() }} products...</p>
  </div>
  } @else {

  <!-- Categories -->
  <div class="d-flex flex-wrap gap-2 mb-3 justify-content-center">
    <button
      class="btn btn-outline-dark"
      [class.active]="selectedType === 'All'"
      (click)="filterByType('All')"
    >
      All {{ pageTitle }}
    </button>
    @for (category of categories; track $index) {
    <button
      class="btn btn-outline-dark"
      [class.active]="selectedType === category"
      (click)="filterByType(category)"
    >
      {{ category.replace('_', ' ') | titlecase }}
    </button>
    }
  </div>
  <!-- üîπ Filter Bar (Price Left, Rating Right) -->
  <div class="filter-bar">
    <div class="filter-item price-filter">
      <label for="priceFilter" class="me-2">Sort by Price:</label>
      <select id="priceFilter" (change)="sortByPrice($event)">
        <option value="default">All Prices</option>
        <option value="low-high">Low to High</option>
        <option value="high-low">High to Low</option>
      </select>
    </div>

    <div class="filter-item rating-filter">
      <label for="ratingFilter" class="me-2">Filter by Rating:</label>
      <select id="ratingFilter" (change)="sortByRating($event)">
        <option value="all">All Ratings</option>
        <option value="low-high">Low to High</option>
        <option value="high-low">High to Low</option>
      </select>
    </div>
  </div>

  <!-- Results Info -->
  <div class="text-center mb-3">
    <p class="text-muted">
      Showing {{ filteredProducts.length }} products @if (selectedType !== 'All') { in
      <strong>{{ selectedType.replace('_', ' ') | titlecase }}</strong>
      }
    </p>
    @if (filteredProducts.length === 0 && selectedType !== 'All') {
    <div class="alert alert-warning">
      No products found in this category. Try "All {{ pageTitle }}".
    </div>
    }
  </div>

  <!-- Product Grid -->
  <div class="row row-cols-2 row-cols-sm-3 row-cols-md-5 g-3">
    @for (product of pagedProducts; track product.id ?? $index) {
    <div class="col">
      <div class="card h-100 shadow-sm position-relative text-center" (click)="openDetail(product)" role="button" tabindex="0">
        <!-- ‚ù§Ô∏è Favorite Icon -->
        <i
          class="bi"
          [ngClass]="
            product.isFavorite
              ? 'bi-heart-fill text-danger favorite-icon'
              : 'bi-heart favorite-icon'
          "
          (click)="toggleFavorite(product)"
        >
        </i>

        <!-- Product Image -->
        <div class="image-container">
          <img
            [src]="product.image_link || 'https://via.placeholder.com/200'"
            alt="{{ product.name }}"
            class="card-img-top"
          />
        </div>

        <!-- Product Info -->
        <div class="card-body p-2 d-flex flex-column justify-content-between">
          <div>
            <h6 class="card-title mb-1">{{ product.name }}</h6>
            <p class="text-muted small mb-1">{{ product.brand || 'Unknown' }}</p>
            <p class="fw-bold mb-1 text-dark">${{ product.price }}</p>

            <!-- Stars -->
            <div class="text-warning small mb-2">
              @for (filled of getStarsArray(product.rating); track $index) {
              <i class="bi" [ngClass]="filled ? 'bi-star-fill' : 'bi-star'"></i>
              }
            </div>
          </div>

          <!-- Add to Cart Button -->
          <button class="btn btn-outline-dark w-100" (click)="addToCart(product)">
            Add to Cart
          </button>
        </div>
      </div>
    </div>
    }
  </div>

  <!-- Pagination -->
  @if (totalPages > 1) {
  <nav class="mt-4">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <button class="page-link" (click)="changePage(currentPage - 1)">Previous</button>
      </li>
      @for (page of totalPagesArray; track $index) {
      <li class="page-item" [class.active]="currentPage === page">
        <button class="page-link" (click)="changePage(page)">{{ page }}</button>
      </li>
      }
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <button class="page-link" (click)="changePage(currentPage + 1)">Next</button>
      </li>
    </ul>
  </nav>
  } }
</div>